<html>
<head>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    #container {
      width: 500px;
      margin: auto;
    }
    #post {
      border: 1px solid #ccc;
      padding: 10px;
    }
    #post img {
      max-width: 100%;
    }
    #error {
      color: red;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Случайный пост с инстаграма</h1>
    <button id="generate">Сгенерировать</button>
    <div id="post"></div>
    <div id="error"></div>
  </div>
  <script>
    // Замените эту переменную на имя пользователя, чей канал вы хотите использовать
    var username = "ваше имя пользователя";

    // Функция для получения всех ID постов с канала
    function get_posts(username, callback) {
      // Используем API инстаграма для получения информации о пользователе
      var url = "https://www.instagram.com/" + username + "/?__a=1";
      $.ajax({
        url: url,
        dataType: "json",
        success: function(data) {
          // Получаем массив постов пользователя
          var posts = data.graphql.user.edge_owner_to_timeline_media.edges;
          // Создаем пустой массив для хранения ID постов
          var ids = [];
          // Проходим по каждому посту и добавляем его ID в массив
          for (var i = 0; i < posts.length; i++) {
            var id = posts[i].node.shortcode;
            ids.push(id);
          }
          // Вызываем callback-функцию с массивом ID постов
          callback(ids);
        },
        error: function() {
          // Показываем сообщение об ошибке
          $("#error").text("Не удалось получить данные с инстаграма. Пожалуйста, попробуйте позже.");
        }
      });
    }

    // Функция для получения случайного элемента из массива
    function random_item(items) {
      return items[Math.floor(Math.random() * items.length)];
    }

    // Функция для получения данных поста по его ID
    function get_post(id) {
      // Используем API инстаграма для получения информации о посте
      var url = "https://www.instagram.com/p/" + id + "/?__a=1";
      $.ajax({
        url: url,
        dataType: "json",
        success: function(data) {
          // Получаем данные о посте
          var post = data.graphql.shortcode_media;
          // Получаем URL изображения
          var image = post.display_url;
          // Получаем текст поста
          var text = post.edge_media_to_caption.edges[0].node.text;
          // Создаем HTML-код для отображения поста
          var html = "<img src='" + image + "'><p>" + text + "</p>";
          // Вставляем HTML-код в элемент с id="post"
          $("#post").html(html);
          // Очищаем сообщение об ошибке
          $("#error").text("");
        },
        error: function() {
          // Показываем сообщение об ошибке
          $("#error").text("Не удалось получить данные о посте. Пожалуйста, попробуйте позже.");
        }
      });
    }

    // Функция для генерации случайного поста
    function generate_post() {
      // Получаем все ID постов с канала
      get_posts(username, function(ids) {
        // Получаем случайный ID поста из массива ids
        var id = random_item(ids);
        // Получаем и показываем пост по его ID
        get_post(id);
      });
    }

    // При нажатии на кнопку с id="generate" вызываем функцию generate_post
    $("#generate").click(generate_post);
  </script>
</body>
</html>
